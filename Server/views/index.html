<html>
<head>
	<title>Nova Card Game</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
	<style type="text/css">
		body{
			margin: 0px;
			border: 0px;
			padding: 0px;
			background-image: url('sapphire-back.png');
			background-size:contain;
			align: center;
		}
		
		.title{
			padding-top:10%;
			width: 100%;
			text-align: center;
			color: silver;
		}
		
		.container{
			width: 100%;
			horizontal-align: center;
		}
		
		input {
			float: center;
			display: block;
			border-radius: 2px;
			margin-left: 2vh;
			margin-right: 2vh;
			box-shadow: 0 6px 16px 0 rgba(0,0,0,0.2), 0 2px 20px 0 rgba(0,0,0,0.19);
		}
		
		.sized{
			width: 33vw;
			height: 4vh;
			margin: 2vh;
		}
		
		.centered {
			position: absolute;
			top: 50%;
			left: 50%;
			/* bring your own prefixes */
			transform: translate(-50%, -50%);
		}
		
		.frame{
			width:100%;
			height:100%;
			padding: 0px;
			margin: 0px;
			border: 0px;
		}
		
		#errordiv{
			border: 3px solid red;
			border-radius: 3px;
			text-align: center;
			background-color: rgba(255,0,0,0.4);
			color: white;
			display: none;
			position: absolute;
			top: 80%;
			left: 50%;
			transform: translate(-50%, -50%); 
			width: 33vw;
			height: 12vh;
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	
	
	
</head>
<body onload="onLoad()">
	
	<div id="logindiv">
		<h1 class="title">Nova Card Game</h1>
		<form id="form" action="login" method="post" class="centered">
			<input type="text" name="username" id="username" class="sized" rows="1" cols="50" placeholder="Username" required>
			<input type="password" name="password" id="password" class="sized" rows="1" cols="25" placeholder="Password" required>
			<input type="checkbox" name="rememberMe" id="saveuser" style="display: inline-block"><label style="color: silver; display: inline">Remember me</label>
			<input type="submit" id="loginbtn" class="sized" rows="1" cols="25" value="login">
		</form>
	</div>

	<div id="errordiv">
		<h4>Wrong username/password !</h4>
	</div>
	
	<script>
		
		var saveUser;
		var username;
		var password;
		var loginBtn;
		var frame;
		var loginDiv;
		var form;

		function onLoad(){
			username = document.getElementById("username");
			password = document.getElementById("password");
			saveUser = document.getElementById("saveuser");
			loginBtn = document.getElementById("loginbtn");
			form = document.getElementById("form");
			form.addEventListener("submit", login);
		}

		function login(event){
			event.preventDefault();

			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					if(this.responseText == "Access granted"){
						document.location = "/match";
					}
					else{
						showErrorPopup();
					}
				}
			};
			var request = "/login";
			var params = username.name+"="+username.value+"&"+password.name+"="+password.value+"&"+saveUser.name+"="+(saveUser.checked ? "on" : "off");
			
			xhttp.open("POST", request, true);
			xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xhttp.send(params);	
		}
		
		function showErrorPopup(){
			password.value = "";
			$("#errordiv").css("display","block");
			animate(1);
		}
		
		function animate(count){
			if(count == 12){
				$("#errordiv").animate({"margin-left": "0px"},50);
				return;
			}
			if((count%2) != 0){
				$("#errordiv").animate({"margin-left": "-4px"},50,function(){animate(++count)});
			}
			else{
				$("#errordiv").animate({"margin-left": "+4px"},50,function(){animate(++count)});
			}
			
		}
		
	</script>

		
</body>
</html>